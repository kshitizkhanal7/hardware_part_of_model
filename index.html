<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hardware is Part of Your Model — CCGT Heat Rate Demo</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;500&family=Literata:ital,wght@0,300;0,400;0,600;1,300;1,400&display=swap');

:root {
  --bg:#07080c; --bg2:#0d0f16; --bg3:#12151f;
  --border:#1c2030; --border2:#252a3a;
  --text:#b8c4d8; --muted:#4a5470; --muted2:#6b7899;
  --fp64:#4a9eff; --fp32:#ff5757; --true:#34d399; --amber:#fbbf24;
  --white:#e8eeff;
  --mono:'IBM Plex Mono',monospace;
  --serif:'Literata',Georgia,serif;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{background:var(--bg);color:var(--text);font-family:var(--serif);font-size:17px;line-height:1.75;overflow-x:hidden}

#pbar{position:fixed;top:0;left:0;height:2px;width:0%;background:linear-gradient(90deg,var(--fp64),var(--fp32));z-index:999;transition:width .08s linear}

nav{position:fixed;top:0;left:0;right:0;height:48px;display:flex;align-items:center;justify-content:space-between;padding:0 2rem;background:rgba(7,8,12,.9);backdrop-filter:blur(16px);border-bottom:1px solid var(--border);z-index:900;font-family:var(--mono);font-size:.65rem;letter-spacing:.12em}
.nav-brand{color:var(--white);font-weight:500}.nav-brand em{color:var(--fp64);font-style:normal}
.nav-links{display:flex;gap:1.6rem}
.nav-links a{color:var(--muted2);text-decoration:none;transition:color .2s}.nav-links a:hover{color:var(--white)}

/* ── HERO ── */
.hero{min-height:100vh;display:flex;flex-direction:column;justify-content:flex-end;padding:0 3rem 5rem;max-width:1100px;margin:0 auto;position:relative}
.hero-bg{position:fixed;top:0;left:0;right:0;height:100vh;z-index:-1;overflow:hidden}
.hero-bg canvas{width:100%!important;height:100%!important;opacity:.35}
.hero-kicker{font-family:var(--mono);font-size:.62rem;letter-spacing:.22em;color:var(--fp64);text-transform:uppercase;margin-bottom:1.2rem;opacity:0;animation:fu .9s .2s forwards}
h1{font-size:clamp(2.6rem,5.5vw,4.4rem);font-weight:600;line-height:1.08;color:var(--white);letter-spacing:-.025em;margin-bottom:1.4rem;opacity:0;animation:fu .9s .35s forwards;max-width:820px}
h1 .accent{background:linear-gradient(135deg,var(--fp64) 20%,var(--fp32));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hero-desc{font-size:1.05rem;color:var(--muted2);max-width:580px;margin-bottom:2rem;font-family:var(--mono);line-height:1.6;opacity:0;animation:fu .9s .5s forwards}
.hero-pills{display:flex;gap:.75rem;flex-wrap:wrap;opacity:0;animation:fu .9s .65s forwards}
.pill{font-family:var(--mono);font-size:.63rem;letter-spacing:.1em;padding:.35rem .8rem;border-radius:2px;border:1px solid;text-transform:uppercase}
.pill-64{color:var(--fp64);border-color:var(--fp64);background:rgba(74,158,255,.08)}
.pill-32{color:var(--fp32);border-color:var(--fp32);background:rgba(255,87,87,.08)}
.pill-n{color:var(--muted2);border-color:var(--border2)}
.scroll-cue{position:absolute;bottom:2rem;left:3rem;font-family:var(--mono);font-size:.58rem;color:var(--muted);letter-spacing:.18em;text-transform:uppercase;opacity:0;animation:fu .9s 1s forwards;display:flex;align-items:center;gap:.6rem}
.scroll-cue::before{content:'';display:block;width:1px;height:32px;background:linear-gradient(to bottom,transparent,var(--muted))}

/* ── SECTIONS ── */
.section{padding:5rem 3rem;max-width:1100px;margin:0 auto}
.section-inner{max-width:680px}
.section-full{max-width:100%}
.tag{font-family:var(--mono);font-size:.6rem;letter-spacing:.2em;color:var(--fp64);text-transform:uppercase;margin-bottom:.7rem}
h2{font-size:clamp(1.6rem,3vw,2.3rem);font-weight:600;color:var(--white);letter-spacing:-.02em;line-height:1.15;margin-bottom:1rem}
h3{font-size:1.1rem;font-weight:600;color:var(--white);margin-bottom:.6rem;font-family:var(--mono);letter-spacing:-.01em}
p{color:var(--text);margin-bottom:1rem;max-width:660px}
.lead{font-size:1.1rem;color:var(--text);margin-bottom:1.5rem}
strong{color:var(--white)}
.rule{width:100%;max-width:1100px;margin:0 auto;height:1px;background:linear-gradient(90deg,transparent,var(--border),transparent)}

/* ── STAT GRID ── */
.stat-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:1px;background:var(--border);border:1px solid var(--border);border-radius:6px;overflow:hidden;margin:2rem 0}
.stat{background:var(--bg2);padding:1.4rem 1.6rem;position:relative;overflow:hidden}
.stat::before{content:'';position:absolute;top:0;left:0;right:0;height:2px}
.s64::before{background:var(--fp64)}.s32::before{background:var(--fp32)}.sgap::before{background:var(--amber)}.strue::before{background:var(--true)}
.stat-lbl{font-family:var(--mono);font-size:.58rem;letter-spacing:.14em;text-transform:uppercase;color:var(--muted2);margin-bottom:.45rem}
.stat-val{font-family:var(--mono);font-size:1.75rem;font-weight:500;line-height:1;margin-bottom:.2rem}
.s64 .stat-val{color:var(--fp64)}.s32 .stat-val{color:var(--fp32)}.sgap .stat-val{color:var(--amber)}.strue .stat-val{color:var(--true)}
.stat-sub{font-size:.72rem;color:var(--muted);font-family:var(--mono)}

/* ── CHARTS ── */
.chart-box{background:var(--bg2);border:1px solid var(--border);border-radius:6px;padding:1.4rem 1.6rem;margin:1.5rem 0}
.chart-hdr{display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;gap:.5rem;margin-bottom:1rem}
.chart-title{font-family:var(--mono);font-size:.65rem;letter-spacing:.12em;text-transform:uppercase;color:var(--muted2)}
.legend{display:flex;gap:1.2rem;flex-wrap:wrap}
.leg{display:flex;align-items:center;gap:.35rem;font-family:var(--mono);font-size:.6rem;color:var(--muted2)}
.leg-line{width:18px;height:2px;border-radius:1px;flex-shrink:0}
.leg-dash{background:repeating-linear-gradient(90deg,var(--c,#fff) 0,var(--c,#fff) 4px,transparent 4px,transparent 8px)!important}
canvas{width:100%!important}

/* ── TRADEOFF BOX ── */
.tradeoff{display:grid;grid-template-columns:1fr 1fr;gap:1px;background:var(--border);border:1px solid var(--border);border-radius:6px;overflow:hidden;margin:1.5rem 0}
.tcard{background:var(--bg2);padding:1.4rem 1.6rem}
.tcard-lbl{font-family:var(--mono);font-size:.6rem;letter-spacing:.15em;text-transform:uppercase;margin-bottom:.5rem}
.c64{color:var(--fp64)}.c32{color:var(--fp32)}.camber{color:var(--amber)}.ctrue{color:var(--true)}
.tcard-val{font-size:1rem;color:var(--white);line-height:1.4}
.tcard-sub{font-size:.8rem;color:var(--muted2);margin-top:.3rem}

/* ── CALLOUT ── */
.callout{border-left:2px solid var(--amber);background:rgba(251,191,36,.04);padding:1rem 1.4rem;border-radius:0 4px 4px 0;margin:1.5rem 0;font-family:var(--mono);font-size:.85rem;color:var(--text);line-height:1.6}
.callout strong{color:var(--amber)}

/* ── MONO TABLE ── */
.mtable{width:100%;border-collapse:collapse;font-family:var(--mono);font-size:.75rem;margin:1.5rem 0}
.mtable th{text-align:left;color:var(--muted2);font-weight:400;letter-spacing:.1em;text-transform:uppercase;padding:.6rem .8rem;border-bottom:1px solid var(--border)}
.mtable td{padding:.55rem .8rem;border-bottom:1px solid var(--border);color:var(--text)}
.mtable tr:last-child td{border-bottom:none}
.mtable .v64{color:var(--fp64)}.mtable .v32{color:var(--fp32)}.mtable .vgap{color:var(--amber)}

/* ── FOOTER ── */
footer{padding:3rem;max-width:1100px;margin:0 auto;border-top:1px solid var(--border);font-family:var(--mono);font-size:.65rem;color:var(--muted);display:flex;justify-content:space-between;flex-wrap:wrap;gap:1rem}
footer a{color:var(--fp64);text-decoration:none}

@keyframes fu{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:translateY(0)}}
.fade-in{opacity:0;transform:translateY(16px);transition:opacity .7s ease,transform .7s ease}
.fade-in.visible{opacity:1;transform:translateY(0)}
@media(max-width:640px){
  .hero,.section{padding-left:1.4rem;padding-right:1.4rem}
  h1{font-size:2.2rem}.tradeoff{grid-template-columns:1fr}
  .nav-links{display:none}
}
</style>
</head>
<body>
<div id="pbar"></div>

<nav>
  <span class="nav-brand">Hardware is <em>part of your model</em></span>
</nav>

<div class="hero-bg"><canvas id="hero-canvas"></canvas></div>

<section class="hero">
  <div class="hero-kicker">CCGT Heat Rate Demo &nbsp;·&nbsp; FP64 vs FP32</div>
  <h1>Same optimizer. Same data.<br>Same loss function.<br><span class="accent">Different machine — different model.</span></h1>
  <p class="hero-desc">FP64 (CPU) vs FP32 (GPU) on a quadratic heat rate curve.<br>Three parameters. High school algebra. $545,000/yr of consequence.</p>
  <div class="hero-pills">
    <span class="pill pill-64">FP64 &nbsp;·&nbsp; CPU</span>
    <span class="pill pill-32">FP32 &nbsp;·&nbsp; GPU</span>
    <span class="pill pill-n">N = 350 observations</span>
    <span class="pill pill-n">200 bootstrap samples</span>
    <span class="pill pill-n">L-BFGS-B · same optimizer</span>
  </div>
  <div class="scroll-cue">scroll to explore</div>
</section>

<div class="rule"></div>

<!-- ── SETUP ── -->
<section class="section" id="setup">
  <div class="section-inner fade-in">
    <div class="tag">01 · The Model</div>
    <h2>A gas plant heat rate curve — the simplest possible test</h2>
    <p class="lead">The <strong>Augmented Willan's Line</strong> is the industry standard model for how a gas turbine's fuel efficiency varies with power output, temperature, and equipment wear.</p>
    <p>HR(P, T, d) = (a + bP + cP²) · (1 + α·ΔT) · (1 + β·d)</p>
    <p style="font-family:var(--mono);font-size:.8rem;color:var(--muted2)">Three main parameters (a, b, c) define the U-shaped curve. P* = −b/2c is the economic optimum — the power level where the plant burns fuel most efficiently. The model is fit to 350 simulated plant operating observations with realistic measurement noise.</p>
  </div>
  <div class="stat-grid fade-in" style="max-width:800px;margin-top:2rem">
    <div class="stat strue"><div class="stat-lbl">True P_opt</div><div class="stat-val" id="s-popt-true">350</div><div class="stat-sub">MW — efficiency minimum</div></div>
    <div class="stat strue"><div class="stat-lbl">True HR_min</div><div class="stat-val">7.80</div><div class="stat-sub">MMBtu/MWh at P_opt</div></div>
    <div class="stat strue"><div class="stat-lbl">Observations</div><div class="stat-val">350</div><div class="stat-sub">biased toward mid-load dispatch zone</div></div>
    <div class="stat strue"><div class="stat-lbl">Gas price</div><div class="stat-val">$4.50</div><div class="stat-sub">per MMBtu</div></div>
  </div>
  <div class="chart-box fade-in" style="max-width:800px">
    <div class="chart-hdr">
      <span class="chart-title">A · Heat Rate Curves — FP64 vs FP32 vs Ground Truth</span>
      <div class="legend">
        <span class="leg"><span class="leg-line" style="background:var(--true)"></span>True HR</span>
        <span class="leg"><span class="leg-line" style="background:var(--fp64)"></span>FP64 fit</span>
        <span class="leg"><span class="leg-line" style="background:var(--fp32)"></span>FP32 fit</span>
        <span class="leg"><span class="leg-line leg-dash" style="--c:#fbbf24;height:1px"></span>Thermo floor 7.5</span>
      </div>
    </div>
    <canvas id="chart-hr" height="300"></canvas>
  </div>
</section>

<div class="rule"></div>

<!-- ── RESULTS ── -->
<section class="section" id="results">
  <div class="section-inner fade-in">
    <div class="tag">02 · The Results</div>
    <h2>Two megawatts of disagreement. $545,000 of consequence.</h2>
    <p class="lead">The only variable between the two runs was arithmetic precision. The optimizer, loss function, data, and random seeds were identical.</p>
  </div>
  <div class="stat-grid fade-in">
    <div class="stat s64"><div class="stat-lbl">FP64 Economic Optimum</div><div class="stat-val" id="s-popt64">—</div><div class="stat-sub">MW · double precision</div></div>
    <div class="stat s32"><div class="stat-lbl">FP32 Economic Optimum</div><div class="stat-val" id="s-popt32">—</div><div class="stat-sub">MW · single precision</div></div>
    <div class="stat sgap"><div class="stat-lbl">Annual Dispatch Cost Gap</div><div class="stat-val" id="s-gap">—</div><div class="stat-sub">@ 350 MW · 8,000 hr/yr · $4.50/MMBtu · one plant</div></div>
    <div class="stat s64"><div class="stat-lbl">FP64 Dispatch Cost</div><div class="stat-val" id="s-cost64">—</div><div class="stat-sub">$/MWh at 350 MW</div></div>
    <div class="stat s32"><div class="stat-lbl">FP32 Dispatch Cost</div><div class="stat-val" id="s-cost32">—</div><div class="stat-sub">$/MWh at 350 MW</div></div>
    <div class="stat strue"><div class="stat-lbl">True Dispatch Cost</div><div class="stat-val" id="s-cost-true">—</div><div class="stat-sub">$/MWh — ground truth</div></div>
  </div>
</section>

<div class="rule"></div>

<!-- ── TRADEOFF ── -->
<section class="section" id="tradeoff">
  <div class="section-inner fade-in">
    <div class="tag">03 · The Tradeoff</div>
    <h2>FP32 is a better statistician.<br>FP64 is a better engineer.</h2>
    <p class="lead">Neither platform chose this tradeoff. The arithmetic made it for them. FP32 fits the observed data more closely. FP64 satisfies the physical and regulatory constraints more tightly. These are two different models of the same plant.</p>
  </div>
  <div class="tradeoff fade-in">
    <div class="tcard"><div class="tcard-lbl c32">FP32 — Statistical Fit</div><div class="tcard-val" id="t-lfit32">—</div><div class="tcard-sub">L_fit (MSE) — lower is better data fit</div></div>
    <div class="tcard"><div class="tcard-lbl c64">FP64 — Statistical Fit</div><div class="tcard-val" id="t-lfit64">—</div><div class="tcard-sub">FP64 fits the data worse — accepts the statistical cost</div></div>
    <div class="tcard"><div class="tcard-lbl c64">FP64 — Physics Violation</div><div class="tcard-val" id="t-lphys64">—</div><div class="tcard-sub">L_phys — lower means tighter constraint satisfaction</div></div>
    <div class="tcard"><div class="tcard-lbl c32">FP32 — Physics Violation</div><div class="tcard-val" id="t-lphys32">—</div><div class="tcard-sub">FP32 incurs more physics penalty — looser constraints</div></div>
  </div>
  <div class="callout fade-in">
    <strong>The implicit hyperparameter:</strong> Hardware acts as an unset, undocumented hyperparameter that silently decides the fit-vs-physics tradeoff. The same loss function, on the same data, produces different tradeoff positions depending on the arithmetic precision of the machine.
  </div>
  <div class="chart-box fade-in" style="max-width:800px">
    <div class="chart-hdr">
      <span class="chart-title">B · Where 30 Restarts Land: (L_fit, L_phys) scatter</span>
      <div class="legend">
        <span class="leg"><span class="leg-line" style="background:var(--fp64)"></span>FP64 restarts</span>
        <span class="leg"><span class="leg-line" style="background:var(--fp32)"></span>FP32 restarts</span>
      </div>
    </div>
    <canvas id="chart-scatter" height="320"></canvas>
  </div>
</section>

<div class="rule"></div>

<!-- ── BOOTSTRAP ── -->
<section class="section" id="bootstrap">
  <div class="section-inner fade-in">
    <div class="tag">04 · Bootstrap Uncertainty</div>
    <h2>200 resamples. The spread is not noise.</h2>
    <p class="lead">200 bootstrap samples per platform, each refit from scratch. FP32 is consistently less certain about where the economic optimum is — a 52% wider uncertainty band on the number that determines dispatch bids.</p>
  </div>
  <div class="stat-grid fade-in" style="max-width:700px">
    <div class="stat s64"><div class="stat-lbl">FP64 P_opt std</div><div class="stat-val" id="s-bstd64">—</div><div class="stat-sub">MW across 200 bootstrap samples</div></div>
    <div class="stat s32"><div class="stat-lbl">FP32 P_opt std</div><div class="stat-val" id="s-bstd32">—</div><div class="stat-sub">MW — <span id="s-bstd-ratio">—</span>x wider</div></div>
    <div class="stat s64"><div class="stat-lbl">FP64 cost std</div><div class="stat-val" id="s-bcstd64">—</div><div class="stat-sub">$/MWh dispatch cost uncertainty</div></div>
    <div class="stat s32"><div class="stat-lbl">FP32 cost std</div><div class="stat-val" id="s-bcstd32">—</div><div class="stat-sub">$/MWh dispatch cost uncertainty</div></div>
  </div>
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;max-width:900px" class="fade-in">
    <div class="chart-box">
      <div class="chart-hdr"><span class="chart-title">C · P_opt Distribution</span></div>
      <canvas id="chart-boot-popt" height="260"></canvas>
    </div>
    <div class="chart-box">
      <div class="chart-hdr"><span class="chart-title">D · Dispatch Cost Distribution</span></div>
      <canvas id="chart-boot-cost" height="260"></canvas>
    </div>
  </div>
</section>

<div class="rule"></div>

<!-- ── PARETO ── -->
<section class="section" id="pareto">
  <div class="section-inner fade-in">
    <div class="tag">05 · Pareto Frontier</div>
    <h2>The same tradeoff surface — traced differently by each platform</h2>
    <p>By sweeping the weight on statistical fit vs physics penalty, we trace a Pareto frontier for each platform. Same loss function, same sweep. The two frontiers diverge — hardware is constituting which tradeoffs are reachable.</p>
  </div>
  <div class="chart-box fade-in" style="max-width:800px">
    <div class="chart-hdr">
      <span class="chart-title">E · Pareto Frontier: Statistical Fit vs Physics Constraint Violation</span>
      <div class="legend">
        <span class="leg"><span class="leg-line" style="background:var(--fp64)"></span>FP64 frontier</span>
        <span class="leg"><span class="leg-line" style="background:var(--fp32)"></span>FP32 frontier</span>
      </div>
    </div>
    <canvas id="chart-pareto" height="320"></canvas>
  </div>
</section>

<div class="rule"></div>

<!-- ── COMPLIANCE ── -->
<section class="section" id="compliance">
  <div class="section-inner fade-in">
    <div class="tag">06 · Regulatory Compliance</div>
    <h2>FP64 sits twice as close to the violation boundary</h2>
    <p class="lead">FERC requires submitted heat rate curves to be non-decreasing above the economic minimum (dHR/dP ≥ 0). Both models satisfy this rule. But FP64 has <strong id="mono-ratio-txt">—</strong>x less margin than FP32 at rated load.</p>
    <p>If you fit on a CPU workstation and deploy on an embedded FP32 energy management system — the standard plant configuration — that FP64 margin shrinks further on the way out the door. You could cross into a violation without changing a single line of code. The hardware changed.</p>
  </div>
  <div class="stat-grid fade-in" style="max-width:700px">
    <div class="stat s64"><div class="stat-lbl">FP64 Mono Margin @ rated</div><div class="stat-val" id="s-mono64">—</div><div class="stat-sub">dHR/dP at 480 MW — must be ≥ 0</div></div>
    <div class="stat s32"><div class="stat-lbl">FP32 Mono Margin @ rated</div><div class="stat-val" id="s-mono32">—</div><div class="stat-sub">FP32 more conservative — <span id="s-mono-ratio">—</span>x larger margin</div></div>
  </div>
  <div class="chart-box fade-in" style="max-width:800px">
    <div class="chart-hdr">
      <span class="chart-title">F · Incremental Heat Rate dHR/dP &nbsp;·&nbsp; FERC must be ≥ 0 above eco-min</span>
      <div class="legend">
        <span class="leg"><span class="leg-line" style="background:var(--true)"></span>True</span>
        <span class="leg"><span class="leg-line" style="background:var(--fp64)"></span>FP64</span>
        <span class="leg"><span class="leg-line" style="background:var(--fp32)"></span>FP32</span>
        <span class="leg"><span class="leg-line" style="background:var(--amber)"></span>Boundary (0)</span>
      </div>
    </div>
    <canvas id="chart-ihrc" height="280"></canvas>
  </div>

  <!-- Full results table -->
  <div class="fade-in" style="margin-top:3rem">
    <h3>Full Results Table</h3>
    <table class="mtable">
      <thead><tr><th>Metric</th><th>FP64</th><th>FP32</th><th>|Δ|</th></tr></thead>
      <tbody id="results-table"></tbody>
    </table>
  </div>
</section>

<div class="rule"></div>

<!-- ── TAKEAWAY ── -->
<section class="section">
  <div class="section-inner fade-in">
    <div class="tag">07 · Takeaway</div>
    <h2>Hardware is an implicit hyperparameter</h2>
    <p>This is not a deep learning phenomenon. No neural networks, no stochastic gradient descent, no random initialization. A quadratic equation fit to 350 points with a deterministic optimizer — and the hardware still constitutes the model.</p>
    <p>The desktop era of energy and transportation modeling kept this invisible: same machine builds it, same machine runs it, hardware is constant. That era is ending. Models now cross hardware boundaries at every step — trained on cloud GPUs, deployed on embedded ARM controllers, audited from laptops.</p>
    <p>Each crossing is a silent reset of this implicit hyperparameter. The practical fix: validate on the hardware the model will actually run on, before you report results or submit a regulatory curve. Add the hardware platform to the model card alongside the software version and the data version.</p>
    <p>The computer isn't just where your model runs. It's part of what your model is.</p>
    <div class="callout" style="margin-top:1.5rem">
      <strong>Methodology:</strong> Augmented Willan's Line · L-BFGS-B optimizer (identical on both paths) · FP32 simulated via explicit float32 dtype cast before each loss evaluation · N=350 synthetic CCGT observations (seed=42) · 200 bootstrap resamples · 30 random restarts per platform · multi-objective loss: MSE + physics penalty + smoothness regularisation
    </div>
  </div>
</section>

<footer></footer>

<script>
// ── DATA (computed by scipy/numpy, same seed as Python) ──────────────────────
const R = {"best":{"fp64":{"loss":0.31582,"Lfit":0.23112,"Lphys":0.007058,"Popt":346.6,"mono":0.0053,"cost":36.974},"fp32":{"loss":0.46998,"Lfit":0.11776,"Lphys":0.029352,"Popt":345.4,"mono":0.01101,"cost":36.78}},"scatter_restarts":{"fp64":[[0.08577,0.075786],[3.40073,0.106999],[0.23112,0.007058],[0.29915,0.116534],[0.08782,0.029981],[1.55036,0.026019],[0.1097,0.138145],[0.42879,0.100134],[0.03269,0.072526],[0.07834,0.047309],[3.43871,0.109582],[0.05977,0.065426],[0.20307,0.191956],[0.05924,0.078867],[0.08226,0.044719],[0.22789,0.007505],[0.18882,0.184433],[0.06134,0.069715],[0.05037,0.046735],[0.06252,0.095925]],"fp32":[[0.08582,0.075782],[3.3581,0.107922],[0.29915,0.116534],[0.11776,0.029352],[1.55094,0.02597],[0.10896,0.138175],[0.42875,0.100137],[0.26619,0.071031],[3.43728,0.109613],[0.05888,0.065439],[0.28122,0.194801],[0.05951,0.078856],[0.08235,0.044711],[0.11987,0.029818],[0.06943,0.053952],[0.20206,0.184883],[0.06132,0.069717],[0.18287,0.045553],[0.06834,0.096488],[2.93419,0.000699]]},"boot":{"fp64":{"Popt":[341.43,347.41,305.37,318.2,342.59,342.4,341.29,342.47,335.72,342.69,340.29,333.54,362.16,341.15,341.54,342.47,341.34,354.85,337.82,345.69,348.36,351.23,343.06,324.56,339.76,344.51,341.01,342.77,346.32,340.98,343.91,342.59,342.23,345.57,320.51,347.35,344.54,343.07,342.56,295.49,341.62,343.31,338.32,343.5,344.53,342.04,343.22,342.63,341.82,343.51,344.02,333.32,311.36,342.9,292.99,342.36,343.12,341.69,341.39,339.18,343.85,347.81,342.5,343.23,344.36,343.2,356.61,285.31,355.42,341.09,343.77,340.98,342.33,343.27,341.73,348.16,301.83,343.76,341.45,344.28,343.05,329.66,353.65,343.55,343.73,342.75,344.3,343.63,341.1,344.55,341.2,342.59,345.4,343.31,341.32,349.2,343.39,342.62,346.65,305.44,344.26,328.96,345.46,346.56,346.63,313.66,342.55,343.93,339.48,341.7,342.33,359.04,342.69,327.18,342.07,341.67,345.16,342.85,342.91,342.14,343.92,341.68,343.18,346.87,337.6,341.88,341.59,341.95,340.85,343.05,342.67,342.73,343.06,341.47,340.84,343.04,361.97,341.19,349.71,329.59,347.63,342.17,345.7,342.26,340.63,349.54,328.94,341.68,300.25,343.75,341.05,356.31,344.8,342.49,302.73,351.36,343.76,365.75,350.83,342.5,342.17,342.02,362.67,339.86,342.45,342.79,343.36,340.43,342.72,342.73,356.89,344.18,342.6,342.11,342.31,354.78,341.83,345.47,346.33,342.02,345.69,346.5,355.48,343.1,342.54,328.34,355.82,346.12,310.98,342.71,327.95,366.91,298.61,343.6,341.16,349.93,341.92,334.06,342.3,351.65],"cost":[35.9437,36.542,35.2379,35.3849,37.6103,35.9936,36.4441,36.2234,37.6381,36.6166,37.6011,37.7916,36.8576,36.0362,36.3753,36.0232,36.6197,37.1584,35.9353,36.5351,37.0423,36.6232,36.1198,35.4107,35.7714,36.1025,36.8363,35.9071,36.7204,37.6389,36.0996,35.9868,36.2292,36.3624,35.1347,38.272,36.2636,36.0496,36.3424,34.6656,35.6542,36.3731,35.4042,36.1068,36.3168,36.2138,36.1096,36.0679,36.4519,36.4775,36.3537,35.7337,34.4295,36.1762,34.6768,35.9455,36.1223,35.924,36.2461,36.3555,36.1095,36.4891,35.9042,36.3104,36.167,36.1638,36.7124,35.0865,36.6695,36.0733,36.1646,36.8366,35.8342,36.2342,36.0225,36.7265,34.5876,36.0932,36.0844,36.5234,36.223,35.2498,36.7209,36.2116,35.6703,36.5827,36.6587,35.8635,36.1102,36.5719,36.189,37.8669,36.5263,35.8703,36.0354,36.8547,35.9526,36.3152,36.6464,34.4312,36.6683,35.7871,36.415,36.7828,36.8089,34.4768,36.156,36.817,35.8843,35.8779,36.4089,36.7092,35.641,35.5257,35.8257,35.7924,36.7063,36.1176,36.4138,35.9844,36.7924,35.9047,36.6693,36.517,35.6792,36.4858,35.9161,36.0658,36.1499,35.9018,36.2956,36.357,35.8846,36.2682,35.8429,36.4673,36.9207,36.4886,37.9701,35.2203,36.725,35.9233,36.1463,36.3846,36.3185,36.649,35.7805,36.3806,34.4937,36.4269,36.4378,36.6163,37.6747,36.2484,34.47,38.002,36.3764,37.4233,36.5808,35.9219,35.9913,35.7984,37.0032,35.8568,36.0853,36.0506,36.0322,36.378,35.6891,36.4641,36.7195,36.3456,36.1654,36.153,36.0811,36.705,35.9443,36.1817,36.7699,36.1782,36.7876,36.8293,37.8076,35.8047,36.4215,35.2421,36.561,36.8683,34.5801,36.0737,35.4072,37.0509,34.6764,36.0188,36.2234,36.75,36.3785,36.0271,36.6254,36.4646],"Lfit":[0.03537,0.10724,0.32592,0.19239,0.22961,0.03523,0.08625,0.06312,0.24742,0.1099,0.24611,0.2351,0.11799,0.06214,0.08149,0.03857,0.11012,0.21498,0.06621,0.08044,0.24764,0.07246,0.04283,0.13985,0.0936,0.05424,0.14389,0.03417,0.10138,0.25675,0.0555,0.06646,0.05392,0.06123,0.18505,0.24029,0.05907,0.03608,0.06845,0.53741,0.09315,0.07483,0.082,0.03969,0.05709,0.05303,0.03879,0.03796,0.07739,0.08081,0.08059,0.08184,0.32556,0.04807,0.54546,0.0339,0.03962,0.03614,0.06539,0.11096,0.03738,0.07544,0.06617,0.0682,0.04112,0.04346,0.08451,0.75924,0.07345,0.05015,0.04042,0.17018,0.06947,0.05019,0.03838,0.16267,0.53136,0.0558,0.04413,0.08518,0.0497,0.10844,0.07483,0.05217,0.08204,0.10074,0.1087,0.02773,0.04905,0.08257,0.064,0.21913,0.09947,0.03057,0.06233,0.11413,0.0319,0.06379,0.10852,0.4314,0.09915,0.11098,0.06329,0.10703,0.11316,0.29616,0.04604,0.18039,0.06148,0.03497,0.09227,0.09141,0.05189,0.11776,0.03333,0.0296,0.10063,0.04168,0.07568,0.03537,0.12592,0.03831,0.10594,0.09484,0.0605,0.08523,0.03403,0.04041,0.06382,0.02975,0.07664,0.07307,0.03011,0.06679,0.03583,0.0783,0.09771,0.12498,0.22883,0.11181,0.13341,0.03338,0.061,0.09522,0.08155,0.1635,0.10522,0.07835,0.46326,0.07463,0.10692,0.0785,0.23145,0.06322,0.44219,0.2309,0.06623,0.24681,0.06804,0.03202,0.03547,0.07106,0.09946,0.04821,0.04063,0.03699,0.05971,0.11781,0.03078,0.09126,0.08004,0.06535,0.05972,0.05073,0.04051,0.07691,0.03529,0.07181,0.14988,0.05257,0.10459,0.12089,0.22299,0.02966,0.08172,0.11526,0.06932,0.13444,0.31195,0.03852,0.12069,0.11376,0.54974,0.05621,0.06574,0.12645,0.07452,0.09135,0.10546,0.06718]},"fp32":{"Popt":[318.16,344.51,305.36,346.8,342.07,342.5,331.79,342.24,343.24,343.66,341.85,342.78,342.09,341.15,320.19,343.63,313.05,317.43,337.84,345.62,323.0,351.26,344.4,324.57,366.59,344.51,340.51,342.92,322.39,348.48,354.36,342.82,340.42,346.19,320.51,386.9,343.31,334.14,318.38,295.5,341.62,344.38,357.02,314.9,354.07,307.64,344.05,342.92,340.51,342.79,345.02,333.32,344.9,291.66,293.0,336.24,325.9,344.04,340.9,340.21,327.44,350.46,360.45,361.62,345.56,342.54,356.61,285.31,355.42,274.2,342.47,340.87,342.23,342.59,308.77,318.6,301.83,343.29,342.0,347.13,339.5,329.68,343.59,366.91,340.81,342.6,344.5,350.84,342.94,348.34,340.85,320.24,348.68,330.87,334.83,348.8,327.22,306.61,349.55,305.45,334.36,341.94,345.85,347.34,308.34,342.96,343.87,351.76,339.48,313.1,346.55,359.04,336.07,344.79,325.9,316.71,331.32,344.23,324.24,342.57,342.55,341.49,344.21,386.88,337.59,341.52,344.06,339.0,340.86,343.7,337.73,339.18,332.53,341.42,341.51,342.83,361.94,342.94,341.78,329.59,350.94,337.7,345.7,298.81,340.09,349.95,328.95,341.68,300.25,387.91,343.38,341.29,343.7,383.28,302.73,341.71,344.46,367.59,350.83,323.3,343.55,360.79,362.68,291.85,343.35,344.07,343.75,343.48,344.24,339.84,344.88,371.95,342.62,341.98,342.17,342.81,316.0,342.33,342.19,298.5,343.92,401.32,351.41,343.41,309.06,343.66,355.83,345.53,343.04,321.47,327.97,366.9,298.61,347.25,341.19,350.89,330.93,334.05,341.77,341.85],"cost":[34.9866,36.8451,35.2394,36.7361,36.4587,36.2151,35.4336,36.2931,36.7292,36.9253,36.4748,35.8326,35.891,36.0363,34.5217,36.2698,35.0196,35.0399,35.9327,36.8246,35.8272,36.6207,36.337,35.4106,36.9142,36.1023,36.8266,36.118,35.8283,36.4689,36.5745,35.999,36.5676,36.3838,35.1339,37.7358,35.7293,35.9268,35.0135,34.6655,35.6536,36.6205,36.7468,34.8799,36.3399,34.8063,36.3526,36.3062,35.9087,36.7317,36.6244,35.7333,36.3935,34.9344,34.6765,35.8899,35.6137,36.1402,36.5063,36.675,35.5349,36.9104,36.7346,36.82,36.4235,35.9134,36.7122,35.0863,36.6695,36.1144,35.8792,36.3626,35.8226,36.4509,34.4286,34.9355,34.5877,36.0684,36.3137,36.8078,35.8598,35.2474,36.3005,36.9714,36.5205,36.5681,36.6739,36.4009,36.2663,36.1793,36.175,34.7508,36.795,35.3145,35.6889,36.8515,35.2392,34.9762,36.9403,34.4311,35.7639,36.6549,36.8043,36.5976,35.5359,36.1378,36.4173,35.8181,35.8846,34.486,36.8224,36.7089,35.444,36.364,35.1722,34.5351,35.3413,36.3625,34.7668,36.2236,36.7528,36.1523,36.2636,37.6787,35.6798,36.4738,36.2239,35.9153,36.149,36.1382,35.7284,36.0794,35.5546,36.267,36.0752,36.4631,36.9229,36.8355,36.1542,35.22,37.0593,35.9351,36.1463,34.741,35.7843,37.0342,35.7796,36.3802,34.4936,37.7989,36.6578,36.2023,36.3108,37.4866,34.4701,35.8987,36.6618,37.4466,36.5802,35.103,36.3034,36.7319,37.0028,34.9882,36.3277,36.5249,36.0516,36.5124,36.3402,36.6761,36.1517,37.2194,36.1785,36.3865,36.3369,36.5799,34.7213,36.0769,36.1222,34.6124,36.4073,38.1491,36.4476,35.9988,34.3626,36.0435,36.5599,36.8618,36.4603,35.3072,35.4046,37.0513,34.6763,36.727,36.2206,37.0749,35.7087,36.0288,36.264,36.0277],"Lfit":[0.21032,0.13768,0.326,0.10644,0.07953,0.06012,0.09329,0.06529,0.1469,0.13901,0.08912,0.05427,0.06204,0.06214,0.23624,0.06464,0.25752,0.21795,0.06601,0.11235,0.15258,0.07231,0.06872,0.13984,0.17107,0.05423,0.14488,0.06001,0.16177,0.06409,0.07079,0.06653,0.10556,0.05985,0.18499,0.25737,0.07095,0.08356,0.2047,0.5374,0.09329,0.10449,0.06743,0.24573,0.09551,0.33633,0.06487,0.06511,0.07766,0.11505,0.11239,0.08181,0.0625,0.72256,0.54544,0.07215,0.12911,0.05891,0.10028,0.14478,0.11446,0.10663,0.11431,0.08712,0.06753,0.05841,0.08449,0.7592,0.07345,1.79547,0.06112,0.07855,0.06922,0.07872,0.37993,0.21282,0.53137,0.05645,0.06916,0.11615,0.06609,0.10824,0.06206,0.13701,0.09822,0.10033,0.1103,0.05792,0.06184,0.07911,0.06455,0.20998,0.12696,0.09399,0.08132,0.11257,0.11895,0.33246,0.14089,0.43139,0.07725,0.12979,0.12315,0.07508,0.27832,0.05509,0.07561,0.26942,0.0615,0.32355,0.13136,0.09139,0.0905,0.06193,0.1389,0.25533,0.09405,0.06564,0.18544,0.06143,0.12599,0.06499,0.06042,0.23814,0.06054,0.08564,0.05731,0.06261,0.06376,0.05504,0.06545,0.06773,0.084,0.06694,0.05954,0.07864,0.0979,0.17172,0.06135,0.11178,0.16936,0.06734,0.061,0.62405,0.058,0.20171,0.10515,0.07833,0.46326,0.33201,0.11892,0.06368,0.06627,0.16651,0.4422,0.05811,0.09578,0.24788,0.068,0.15745,0.06454,0.11446,0.09942,0.75975,0.06715,0.07683,0.05983,0.08958,0.06785,0.12866,0.05491,0.14408,0.06191,0.08033,0.0685,0.09202,0.25437,0.07175,0.06001,0.51397,0.06766,0.47905,0.06531,0.05247,0.38318,0.05262,0.06924,0.13578,0.07566,0.16569,0.12046,0.11379,0.54973,0.10436,0.06554,0.16195,0.09447,0.09145,0.0677,0.05788]}},"curves":{"P":[150.0,158.97435897435898,167.94871794871796,176.92307692307693,185.8974358974359,194.87179487179486,203.84615384615384,212.82051282051282,221.7948717948718,230.76923076923077,239.74358974358975,248.71794871794873,257.6923076923077,266.6666666666667,275.64102564102564,284.61538461538464,293.5897435897436,302.56410256410254,311.53846153846155,320.51282051282055,329.4871794871795,338.46153846153845,347.43589743589746,356.4102564102564,365.38461538461536,374.35897435897436,383.33333333333337,392.3076923076923,401.28205128205127,410.2564102564103,419.2307692307692,428.20512820512823,437.1794871794872,446.15384615384613,455.12820512820514,464.1025641025641,473.0769230769231,482.05128205128204,491.02564102564105,500.0],"HR64":[9.1229,9.0543,8.989,8.9269,8.8679,8.8122,8.7597,8.7103,8.6642,8.6213,8.5815,8.545,8.5117,8.4816,8.4546,8.4309,8.4104,8.3931,8.379,8.368,8.3603,8.3558,8.3545,8.3564,8.3615,8.3698,8.3812,8.3959,8.4138,8.4349,8.4592,8.4867,8.5174,8.5513,8.5884,8.6287,8.6722,8.7189,8.7688,8.822],"HR32":[9.7565,9.6163,9.4827,9.3557,9.2353,9.1215,9.0143,8.9136,8.8196,8.7321,8.6513,8.577,8.5093,8.4482,8.3936,8.3457,8.3044,8.2696,8.2414,8.2199,8.2049,8.1965,8.1947,8.1994,8.2108,8.2287,8.2533,8.2844,8.3221,8.3664,8.4173,8.4748,8.5389,8.6095,8.6868,8.7706,8.861,8.958,9.0616,9.1718],"HRtrue":[10.6895,10.4484,10.2183,9.9993,9.7914,9.5945,9.4087,9.234,9.0703,8.9177,8.7762,8.6457,8.5263,8.418,8.3208,8.2346,8.1595,8.0954,8.0425,8.0006,7.9697,7.95,7.9413,7.9436,7.9571,7.9816,8.0172,8.0638,8.1215,8.1903,8.2702,8.3611,8.4631,8.5761,8.7003,8.8355,8.9817,9.1391,9.3075,9.487],"dHR64":[-0.007816,-0.007459,-0.007102,-0.006746,-0.006389,-0.006032,-0.005675,-0.005319,-0.004962,-0.004605,-0.004249,-0.003892,-0.003535,-0.003178,-0.002822,-0.002465,-0.002108,-0.001752,-0.001395,-0.001038,-0.000681,-0.000325,3.2e-05,0.000389,0.000745,0.001102,0.001459,0.001816,0.002172,0.002529,0.002886,0.003242,0.003599,0.003956,0.004313,0.004669,0.005026,0.005383,0.005739,0.006096],"dHR32":[-0.015986,-0.015252,-0.014518,-0.013784,-0.013049,-0.012315,-0.011581,-0.010847,-0.010113,-0.009379,-0.008645,-0.007911,-0.007176,-0.006442,-0.005708,-0.004974,-0.00424,-0.003506,-0.002772,-0.002037,-0.001303,-0.000569,0.000165,0.000899,0.001633,0.002367,0.003101,0.003836,0.00457,0.005304,0.006038,0.006772,0.007506,0.00824,0.008974,0.009709,0.010443,0.011177,0.011911,0.012645],"dHRtrue":[-0.027,-0.025788,-0.024577,-0.023365,-0.022154,-0.020942,-0.019731,-0.018519,-0.017308,-0.016096,-0.014885,-0.013673,-0.012462,-0.01125,-0.010038,-0.008827,-0.007615,-0.006404,-0.005192,-0.003981,-0.002769,-0.001558,-0.000346,0.000865,0.002077,0.003288,0.0045,0.005712,0.006923,0.008135,0.009346,0.010558,0.011769,0.012981,0.014192,0.015404,0.016615,0.017827,0.019038,0.02025]},"scatter":{"P":[206.2,173.4,153.1,177.5,241.8,267.8,241.1,271.3,168.3,249.4,295.4,288.3,208.3,231.4,265.8,259.4,403.6,339.0,314.4,359.3,303.8,329.9,334.8,404.6,396.9,351.3,350.1,338.8,415.5,304.4,409.0,329.0,344.1,400.2,381.3,320.9,340.9,379.2,311.2,341.9,377.0,301.1,365.8,328.5,378.9,329.3,395.4,386.7,412.9,411.4,335.3,366.8,469.2,479.3,484.7,460.1,491.2,422.9,422.4,461.8,424.1,498.1,455.1,475.7,463.9,479.0,448.5,423.3,459.3,469.3],"HR":[9.653,9.912,10.924,10.12,8.586,8.426,8.855,8.225,10.217,8.598,7.981,8.251,9.183,8.811,8.448,8.322,8.304,7.645,7.894,7.986,8.286,8.002,7.519,8.527,7.971,8.111,7.91,7.9,7.925,7.955,8.158,7.911,7.876,7.888,7.669,7.851,7.707,7.72,7.83,8.047,7.729,7.97,7.791,7.64,8.05,7.895,7.809,7.769,8.24,7.847,7.787,7.804,8.81,9.117,9.119,8.732,9.518,8.152,8.501,8.508,8.3,9.619,8.778,8.753,8.838,8.84,8.768,8.004,8.768,8.981]},"pareto":{"fp64_fit":[0.20484,0.0878,0.03453,0.06154,0.01742,0.04095,0.08954,0.06731,0.13607,0.11335,0.08089,0.04975],"fp64_phys":[0.020517,0.065642,0.080134,0.038267,0.076663,0.089946,0.075506,0.048396,0.018355,0.030515,0.031494,0.05935],"fp32_fit":[0.2062,0.08834,0.08034,0.10238,0.11551,0.04255,0.08949,0.03597,0.12919,0.11239,0.0378,0.05027],"fp32_phys":[0.020499,0.055487,0.078845,0.034845,0.030011,0.089921,0.075518,0.090154,0.025862,0.030501,0.090917,0.059307]},"meta":{"annual_gap":545008,"P_RATED":480.0,"P_ECOMIN":150.0,"DISP_MW":350.0,"GAS_PRICE":4.5,"P_OPT_TRUE":350.0,"N":350,"true_cost":35.1,"boot_std_Popt64":11.87,"boot_std_Popt32":18.12,"boot_std_cost64":0.6607,"boot_std_cost32":0.742,"mono_ratio":2.08,"fp32_better_stat":true,"fp64_better_physics":true}};

// ── POPULATE STATS ───────────────────────────────────────────────────────────
function fmt(v,dec=2){return typeof v==='number'?v.toFixed(dec):v}
function fmtM(v){return '$'+(v/1e6).toFixed(2)+'M'}
function fmtK(v){return '$'+(v/1e3).toFixed(0)+'K'}

document.getElementById('s-popt-true').textContent = R.meta.P_OPT_TRUE;
document.getElementById('s-popt64').textContent = fmt(R.best.fp64.Popt,1);
document.getElementById('s-popt32').textContent = fmt(R.best.fp32.Popt,1);
document.getElementById('s-gap').textContent = '$'+Math.round(R.meta.annual_gap/1000)+'K';
document.getElementById('s-cost64').textContent = '$'+fmt(R.best.fp64.cost,3);
document.getElementById('s-cost32').textContent = '$'+fmt(R.best.fp32.cost,3);
document.getElementById('s-cost-true').textContent = '$'+fmt(R.meta.true_cost,3);
document.getElementById('t-lfit64').textContent = fmt(R.best.fp64.Lfit,5);
document.getElementById('t-lfit32').textContent = fmt(R.best.fp32.Lfit,5);
document.getElementById('t-lphys64').textContent = fmt(R.best.fp64.Lphys,5);
document.getElementById('t-lphys32').textContent = fmt(R.best.fp32.Lphys,5);
document.getElementById('s-bstd64').textContent = fmt(R.meta.boot_std_Popt64,1);
document.getElementById('s-bstd32').textContent = fmt(R.meta.boot_std_Popt32,1);
const ratio = (R.meta.boot_std_Popt32/R.meta.boot_std_Popt64).toFixed(2);
document.getElementById('s-bstd-ratio').textContent = ratio;
document.getElementById('s-bcstd64').textContent = '$'+fmt(R.meta.boot_std_cost64,4);
document.getElementById('s-bcstd32').textContent = '$'+fmt(R.meta.boot_std_cost32,4);
document.getElementById('s-mono64').textContent = fmt(R.best.fp64.mono,5);
document.getElementById('s-mono32').textContent = fmt(R.best.fp32.mono,5);
const mr = fmt(R.meta.mono_ratio,2);
document.getElementById('s-mono-ratio').textContent = mr;
document.getElementById('mono-ratio-txt').textContent = mr;

// Results table
const rows = [
  ['Best-fit total loss',R.best.fp64.loss,R.best.fp32.loss,5],
  ['L_fit — statistical MSE',R.best.fp64.Lfit,R.best.fp32.Lfit,5],
  ['L_phys — constraint violation',R.best.fp64.Lphys,R.best.fp32.Lphys,6],
  ['Economic optimum P* [MW]',R.best.fp64.Popt,R.best.fp32.Popt,1],
  ['Dispatch cost @ 350 MW [$/MWh]',R.best.fp64.cost,R.best.fp32.cost,3],
  ['FERC mono margin @ rated load',R.best.fp64.mono,R.best.fp32.mono,5],
  ['Bootstrap P_opt std [MW]',R.meta.boot_std_Popt64,R.meta.boot_std_Popt32,2],
  ['Bootstrap cost std [$/MWh]',R.meta.boot_std_cost64,R.meta.boot_std_cost32,4],
];
const tbody = document.getElementById('results-table');
rows.forEach(([name,v64,v32,dec])=>{
  const diff = Math.abs(v64-v32);
  const winner64 = name.includes('violation')||name.includes('std') ? v64<v32 : false;
  tbody.innerHTML += `<tr>
    <td>${name}</td>
    <td class="v64">${fmt(v64,dec)}</td>
    <td class="v32">${fmt(v32,dec)}</td>
    <td class="vgap">${fmt(diff,dec)}</td>
  </tr>`;
});

// ── CHART DEFAULTS ───────────────────────────────────────────────────────────
Chart.defaults.color = '#4a5470';
Chart.defaults.borderColor = '#1c2030';
Chart.defaults.font.family = "'IBM Plex Mono', monospace";
Chart.defaults.font.size = 10;

const C64='#4a9eff', C32='#ff5757', CTRUE='#34d399', CAMBER='#fbbf24';

// ── CHART A: HEAT RATE CURVES ────────────────────────────────────────────────
new Chart(document.getElementById('chart-hr'), {
  type:'line',
  data:{
    labels: R.curves.P.map(p=>Math.round(p)),
    datasets:[
      {label:'Observed data',data:R.scatter.HR.map((hr,i)=>({x:R.scatter.P[i],y:hr})),
       type:'scatter',backgroundColor:'rgba(107,120,153,0.25)',pointRadius:3,pointHoverRadius:4,showLine:false,order:4},
      {label:'True HR',data:R.curves.HRtrue,borderColor:CTRUE,borderWidth:2,borderDash:[6,4],fill:false,pointRadius:0,tension:.4,order:1},
      {label:'FP64',data:R.curves.HR64,borderColor:C64,borderWidth:2.5,fill:false,pointRadius:0,tension:.4,order:2},
      {label:'FP32',data:R.curves.HR32,borderColor:C32,borderWidth:2.5,fill:false,pointRadius:0,tension:.4,order:3},
      {label:'Floor 7.5',data:R.curves.P.map(()=>7.5),borderColor:CAMBER,borderWidth:1,borderDash:[3,5],fill:false,pointRadius:0,order:5},
    ]
  },
  options:{
    responsive:true,
    interaction:{mode:'index',intersect:false},
    scales:{
      x:{title:{display:true,text:'Power Output [MW]',color:'#4a5470'},ticks:{maxTicksLimit:8},grid:{color:'#1c2030'}},
      y:{title:{display:true,text:'Heat Rate [MMBtu/MWh]',color:'#4a5470'},grid:{color:'#1c2030'},min:7.0,max:12.0}
    },
    plugins:{
      legend:{display:false},
      tooltip:{backgroundColor:'#0d0f16',borderColor:'#252a3a',borderWidth:1}
    }
  }
});

// ── CHART B: RESTART SCATTER ─────────────────────────────────────────────────
new Chart(document.getElementById('chart-scatter'), {
  type:'scatter',
  data:{
    datasets:[
      {label:'FP64 restarts',data:R.scatter_restarts.fp64.map(r=>({x:r[0],y:r[1]})),
       backgroundColor:C64+'99',pointRadius:7,pointHoverRadius:9},
      {label:'FP32 restarts',data:R.scatter_restarts.fp32.map(r=>({x:r[0],y:r[1]})),
       backgroundColor:C32+'99',pointRadius:7,pointHoverRadius:9},
    ]
  },
  options:{
    responsive:true,
    scales:{
      x:{title:{display:true,text:'L_fit (statistical MSE)',color:'#4a5470'},grid:{color:'#1c2030'}},
      y:{title:{display:true,text:'L_phys (constraint violation)',color:'#4a5470'},grid:{color:'#1c2030'}}
    },
    plugins:{
      legend:{display:false},
      tooltip:{backgroundColor:'#0d0f16',borderColor:'#252a3a',borderWidth:1,
        callbacks:{label:ctx=>`${ctx.dataset.label}: Lfit=${ctx.parsed.x.toFixed(4)}, Lphys=${ctx.parsed.y.toFixed(5)}`}}
    }
  }
});

// ── HISTOGRAM HELPER ─────────────────────────────────────────────────────────
function makeHistogram(data, bins=30){
  const min=Math.min(...data), max=Math.max(...data);
  const w=(max-min)/bins;
  const counts=new Array(bins).fill(0);
  const centers=[];
  for(let i=0;i<bins;i++) centers.push(min+w*(i+.5));
  data.forEach(v=>{
    let b=Math.floor((v-min)/w);
    if(b>=bins) b=bins-1;
    counts[b]++;
  });
  return {centers,counts,width:w};
}

// ── CHART C: BOOTSTRAP P_OPT ────────────────────────────────────────────────
{
  const h64=makeHistogram(R.boot.fp64.Popt);
  const h32=makeHistogram(R.boot.fp32.Popt);
  // merge x axis
  const allCenters=[...h64.centers,...h32.centers].sort((a,b)=>a-b);
  const uniq=[...new Set(allCenters.map(v=>Math.round(v)))];
  new Chart(document.getElementById('chart-boot-popt'),{
    type:'bar',
    data:{
      labels:h64.centers.map(v=>Math.round(v)),
      datasets:[
        {label:'FP64',data:h64.counts,backgroundColor:C64+'88',borderColor:C64,borderWidth:1},
        {label:'FP32',data:h32.counts,backgroundColor:C32+'88',borderColor:C32,borderWidth:1},
      ]
    },
    options:{
      responsive:true,
      scales:{
        x:{title:{display:true,text:'P_opt [MW]',color:'#4a5470'},grid:{color:'#1c2030'},ticks:{maxTicksLimit:6}},
        y:{title:{display:true,text:'Count',color:'#4a5470'},grid:{color:'#1c2030'}}
      },
      plugins:{
        legend:{display:false},
        annotation:{annotations:{line1:{type:'line',xMin:R.meta.P_OPT_TRUE,xMax:R.meta.P_OPT_TRUE,borderColor:CTRUE,borderWidth:2,borderDash:[4,4]}}}
      }
    }
  });
}

// ── CHART D: BOOTSTRAP COST ──────────────────────────────────────────────────
{
  const h64=makeHistogram(R.boot.fp64.cost);
  const h32=makeHistogram(R.boot.fp32.cost);
  new Chart(document.getElementById('chart-boot-cost'),{
    type:'bar',
    data:{
      labels:h64.centers.map(v=>v.toFixed(2)),
      datasets:[
        {label:'FP64',data:h64.counts,backgroundColor:C64+'88',borderColor:C64,borderWidth:1},
        {label:'FP32',data:h32.counts,backgroundColor:C32+'88',borderColor:C32,borderWidth:1},
      ]
    },
    options:{
      responsive:true,
      scales:{
        x:{title:{display:true,text:'Dispatch cost $/MWh',color:'#4a5470'},grid:{color:'#1c2030'},ticks:{maxTicksLimit:6}},
        y:{title:{display:true,text:'Count',color:'#4a5470'},grid:{color:'#1c2030'}}
      },
      plugins:{legend:{display:false}}
    }
  });
}

// ── CHART E: PARETO ──────────────────────────────────────────────────────────
new Chart(document.getElementById('chart-pareto'),{
  type:'scatter',
  data:{
    datasets:[
      {label:'FP64 Pareto',data:R.pareto.fp64_fit.map((f,i)=>({x:f,y:R.pareto.fp64_phys[i]})),
       borderColor:C64,backgroundColor:C64+'cc',showLine:true,pointRadius:5,tension:.3,fill:false},
      {label:'FP32 Pareto',data:R.pareto.fp32_fit.map((f,i)=>({x:f,y:R.pareto.fp32_phys[i]})),
       borderColor:C32,backgroundColor:C32+'cc',showLine:true,pointRadius:5,tension:.3,fill:false},
    ]
  },
  options:{
    responsive:true,
    scales:{
      x:{title:{display:true,text:'L_fit (statistical MSE — lower = better fit)',color:'#4a5470'},grid:{color:'#1c2030'}},
      y:{title:{display:true,text:'L_phys (constraint violation — lower = better physics)',color:'#4a5470'},grid:{color:'#1c2030'}}
    },
    plugins:{legend:{display:false},tooltip:{backgroundColor:'#0d0f16',borderColor:'#252a3a',borderWidth:1}}
  }
});

// ── CHART F: INCREMENTAL HEAT RATE ───────────────────────────────────────────
new Chart(document.getElementById('chart-ihrc'),{
  type:'line',
  data:{
    labels:R.curves.P.map(p=>Math.round(p)),
    datasets:[
      {label:'True dHR/dP',data:R.curves.dHRtrue,borderColor:CTRUE,borderWidth:2,borderDash:[6,4],fill:false,pointRadius:0,tension:.3},
      {label:'FP64',data:R.curves.dHR64,borderColor:C64,borderWidth:2.5,fill:false,pointRadius:0,tension:.3},
      {label:'FP32',data:R.curves.dHR32,borderColor:C32,borderWidth:2.5,fill:false,pointRadius:0,tension:.3},
      {label:'FERC boundary (0)',data:R.curves.P.map(()=>0),borderColor:CAMBER,borderWidth:1.5,borderDash:[3,5],fill:false,pointRadius:0},
    ]
  },
  options:{
    responsive:true,
    interaction:{mode:'index',intersect:false},
    scales:{
      x:{title:{display:true,text:'Power Output [MW]',color:'#4a5470'},ticks:{maxTicksLimit:8},grid:{color:'#1c2030'}},
      y:{title:{display:true,text:'dHR/dP [MMBtu/MWh per MW]',color:'#4a5470'},grid:{color:'#1c2030'}}
    },
    plugins:{
      legend:{display:false},
      tooltip:{backgroundColor:'#0d0f16',borderColor:'#252a3a',borderWidth:1}
    }
  }
});

// ── SCROLL PROGRESS ─────────────────────────────────────────────────────────
const pbar=document.getElementById('pbar');
window.addEventListener('scroll',()=>{
  const h=document.documentElement.scrollHeight-window.innerHeight;
  pbar.style.width=(window.scrollY/h*100)+'%';
});

// ── FADE-IN ON SCROLL ────────────────────────────────────────────────────────
const obs=new IntersectionObserver(entries=>{
  entries.forEach(e=>{if(e.isIntersecting){e.target.classList.add('visible');obs.unobserve(e.target)}});
},{threshold:.12});
document.querySelectorAll('.fade-in').forEach(el=>obs.observe(el));

// ── HERO BACKGROUND: animated precision grid ─────────────────────────────────
{
  const cv=document.getElementById('hero-canvas');
  const ctx=cv.getContext('2d');
  let W,H,pts=[];
  function resize(){W=cv.width=cv.offsetWidth;H=cv.height=cv.offsetHeight;init()}
  function init(){
    pts=[];
    for(let i=0;i<60;i++){
      pts.push({
        x:Math.random()*W, y:Math.random()*H,
        vx:(Math.random()-.5)*.3, vy:(Math.random()-.5)*.3,
        c:Math.random()>.5?C64:C32, r:Math.random()*1.5+.5
      });
    }
  }
  function draw(){
    ctx.clearRect(0,0,W,H);
    // grid
    ctx.strokeStyle='rgba(30,36,55,.6)'; ctx.lineWidth=.5;
    for(let x=0;x<W;x+=40){ctx.beginPath();ctx.moveTo(x,0);ctx.lineTo(x,H);ctx.stroke()}
    for(let y=0;y<H;y+=40){ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(W,y);ctx.stroke()}
    // connections
    pts.forEach((a,i)=>pts.slice(i+1).forEach(b=>{
      const d=Math.hypot(a.x-b.x,a.y-b.y);
      if(d<120){
        ctx.strokeStyle=`rgba(74,158,255,${.15*(1-d/120)})`;
        ctx.lineWidth=.6; ctx.beginPath(); ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y); ctx.stroke();
      }
    }));
    // points
    pts.forEach(p=>{
      ctx.fillStyle=p.c+'99'; ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill();
      p.x+=p.vx; p.y+=p.vy;
      if(p.x<0||p.x>W) p.vx*=-1;
      if(p.y<0||p.y>H) p.vy*=-1;
    });
    requestAnimationFrame(draw);
  }
  window.addEventListener('resize',resize);
  resize(); draw();
}
</script>
</body>
</html>
